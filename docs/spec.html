<!DOCTYPE html>  <html> <head>   <title>spec.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               spec.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*!</span>
<span class="cm"> * Spec unit testing library</span>
<span class="cm"> * http://github.com/kitcambridge/spec</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2011-2012, Kit Cambridge</span>
<span class="cm"> * http://kitcambridge.github.com</span>
<span class="cm"> *</span>
<span class="cm"> * Released under the MIT License.</span>
<span class="cm">*/</span>

<span class="p">;(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">Spec</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">[</span><span class="s2">&quot;amd&quot;</span><span class="p">])</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Export Spec for asynchronous module loaders.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">define</span><span class="p">([</span><span class="s2">&quot;exports&quot;</span><span class="p">],</span> <span class="nx">Spec</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Export for CommonJS environments, web browsers, and JavaScript engines.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Spec</span> <span class="o">=</span> <span class="nx">Spec</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">exports</span> <span class="o">||</span> <span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="s2">&quot;Spec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><strong>noConflict</strong> restores the original value of the <code>Spec</code> variable and
returns a reference to the Spec object.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;noConflict&quot;</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">function</span> <span class="nx">noConflict</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">root</span><span class="p">[</span><span class="s2">&quot;Spec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">original</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>noConflict</code> can't be invoked more than once.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">delete</span> <span class="nx">Spec</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">Spec</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">noConflict</span><span class="p">;</span>
      <span class="p">})(</span><span class="nx">root</span><span class="p">[</span><span class="s2">&quot;Spec&quot;</span><span class="p">])</span>
    <span class="p">}));</span>
  <span class="p">}</span>
<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
  <span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The current version of Spec. Keep in sync with <code>package.json</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">exports</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="s2">&quot;1.0.0rc4&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>Utility Methods.</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>Object::toString</code> exposes the internal <code>[[Class]]</code> name of an object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">getClass</span> <span class="o">=</span> <span class="p">{}.</span><span class="nx">toString</span><span class="p">,</span> <span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="p">{}.</span><span class="nx">hasOwnProperty</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><code>null</code> is aliased as <code>nil</code> to prevent a global variable leak by the Closure
Compiler.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">nil</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><strong>Spec.Environment</strong> stores information about the current environment.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Environment</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">Environment</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Indicates whether the <code>Object::hasOwnProperty</code> function is supported.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;isPropertyOf&quot;</span><span class="o">:</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">isPropertyOf</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;[object Function]&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Indicates whether the JScript <code>[[DontEnum]]</code> bug is present.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;dontEnum&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Indicates whether the Safari 2 shadowed property enumeration bug is
present.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;shadowEnum&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Indicates whether <code>undefined</code> elements in arrays are treated as elisions
(JScript 5.x spec, section 2.1.26).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;undefinedElisions&quot;</span><span class="o">:</span> <span class="o">!</span><span class="p">(</span><span class="mi">0</span> <span class="k">in</span> <span class="p">[</span><span class="k">void</span> <span class="mi">0</span><span class="p">]),</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Indicates whether Node's <code>process.nextTick</code> function is supported.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;nextTick&quot;</span><span class="o">:</span> <span class="k">typeof</span> <span class="nx">process</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">process</span> <span class="o">!=</span> <span class="nx">nil</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Indicates whether the <code>setTimeout</code> function is supported.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;setTimeout&quot;</span><span class="o">:</span> <span class="k">typeof</span> <span class="nx">setTimeout</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Indicates whether Mozilla's LiveConnect APIs are supported.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;java&quot;</span><span class="o">:</span> <span class="k">typeof</span> <span class="nx">java</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">java</span> <span class="o">!=</span> <span class="nx">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">java</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;[object JavaPackage]&quot;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><strong>all</strong> determines whether the callback returns <code>true</code> for all object
members.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">all</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">all</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">memo</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">all</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Tests for bugs in the current environment's <code>for...in</code> algorithm. The
<code>valueOf</code> property inherits the non-enumerable flag from <code>Object::</code> in
JScript.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">Properties</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">valueOf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Safari 2 enumerates shadowed properties twice.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Properties</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">valueOf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><strong>isPropertyOf</strong> determines if a property is a direct property of the
specified object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Environment</span><span class="p">.</span><span class="nx">isPropertyOf</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">memo</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;__proto__&quot;</span><span class="o">:</span> <span class="nx">nil</span> <span class="p">},</span> <span class="o">!</span><span class="p">(</span><span class="s2">&quot;toString&quot;</span> <span class="k">in</span> <span class="nx">memo</span><span class="p">)))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Simulate <code>Object::hasOwnProperty</code> in Safari 2.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Environment</span><span class="p">.</span><span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Capture and break the object's prototype chain. See the ES 5.1 spec,
section 8.6.2.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">original</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">,</span> <span class="nx">result</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>The parenthesized expression prevents an unsafe transformation by the
Closure Compiler.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">result</span> <span class="o">=</span> <span class="nx">property</span> <span class="k">in</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">=</span> <span class="nx">nil</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Restore the original prototype chain.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">=</span> <span class="nx">original</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Iterate over a new instance of the <code>Properties</code> class.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">memo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Properties</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">property</span> <span class="k">in</span> <span class="nx">memo</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Ignore all other properties inherited from <code>Object::</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">memo</span><span class="p">,</span> <span class="nx">property</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">size</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">memo</span> <span class="o">=</span> <span class="nx">nil</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Normalize the iteration algorithm.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">size</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>A list of non-enumerable properties inherited from <code>Object::</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">memo</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;constructor&quot;</span><span class="p">,</span> <span class="s2">&quot;hasOwnProperty&quot;</span><span class="p">,</span> <span class="s2">&quot;isPrototypeOf&quot;</span><span class="p">,</span> <span class="s2">&quot;propertyIsEnumerable&quot;</span><span class="p">,</span> <span class="s2">&quot;toLocaleString&quot;</span><span class="p">,</span> <span class="s2">&quot;toString&quot;</span><span class="p">,</span> <span class="s2">&quot;valueOf&quot;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>JScript ignores shadowed non-enumerable properties.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Environment</span><span class="p">.</span><span class="nx">dontEnum</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">all</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">all</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">length</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">property</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">callback</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">object</span><span class="p">[</span><span class="nx">property</span><span class="p">],</span> <span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Manually invoke the callback for each non-enumerable property.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">memo</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">length</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
          <span class="nx">property</span> <span class="o">=</span> <span class="nx">memo</span><span class="p">[</span><span class="nx">length</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">callback</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">object</span><span class="p">[</span><span class="nx">property</span><span class="p">],</span> <span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Safari 2 enumerates shadowed properties twice.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Environment</span><span class="p">.</span><span class="nx">shadowEnum</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">all</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">all</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Create a set of iterated properties. The <code>prototype</code> property is not
enumerated due to cross-environment inconsistencies.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">memo</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">isFunction</span> <span class="o">=</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;[object Function]&quot;</span><span class="p">,</span> <span class="nx">property</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">property</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Store each property name to prevent double enumeration.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">isFunction</span> <span class="o">&amp;&amp;</span> <span class="nx">property</span> <span class="o">===</span> <span class="s2">&quot;prototype&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">memo</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">memo</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">callback</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">object</span><span class="p">[</span><span class="nx">property</span><span class="p">],</span> <span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>No bugs detected; use the standard <code>for...in</code> algorithm.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">all</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">all</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">isFunction</span> <span class="o">=</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;[object Function]&quot;</span><span class="p">,</span> <span class="nx">isConstructor</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">property</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">isFunction</span> <span class="o">&amp;&amp;</span> <span class="nx">property</span> <span class="o">===</span> <span class="s2">&quot;prototype&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">isConstructor</span> <span class="o">=</span> <span class="nx">property</span> <span class="o">===</span> <span class="s2">&quot;constructor&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">callback</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">object</span><span class="p">[</span><span class="nx">property</span><span class="p">],</span> <span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Manually invoke the callback for the <code>constructor</code> property due to
cross-environment inconsistencies.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="p">(</span><span class="nx">isConstructor</span> <span class="o">||</span> <span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="s2">&quot;constructor&quot;</span><span class="p">))</span> <span class="o">?</span> <span class="o">!!</span><span class="nx">callback</span><span class="p">(</span><span class="s2">&quot;constructor&quot;</span><span class="p">,</span> <span class="nx">object</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span> <span class="nx">object</span><span class="p">)</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">all</span><span class="p">;</span>
  <span class="p">})(),</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p><strong>equals</strong> recursively compares two objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">equals</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">equals</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Comparison algorithm derived from work by Jeremy Ashkenas and Philippe
Rathe.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">stack</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">result</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Identical objects are equivalent.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">left</span> <span class="o">===</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p><code>0</code> and <code>-0</code> are identical, but they aren't equivalent. See the
ECMAScript Harmony <code>egal</code> proposal.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">left</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">left</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">right</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p><code>null</code> and <code>undefined</code> are compared by identity.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">left</span> <span class="o">==</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">left</span> <span class="o">===</span> <span class="nx">right</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">className</span> <span class="o">=</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">left</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">!=</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">right</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Strings, numbers, dates, and booleans are compared by value.
Primitives and their corresponding object wrappers are equivalent;
thus, <code>"5"</code> is equivalent to <code>new String("5")</code>.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">case</span> <span class="s2">&quot;[object String]&quot;</span><span class="o">:</span>
          <span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span> <span class="o">==</span> <span class="nb">String</span><span class="p">(</span><span class="nx">right</span><span class="p">);</span>
        <span class="k">case</span> <span class="s2">&quot;[object Number]&quot;</span><span class="o">:</span>
          <span class="nx">left</span> <span class="o">=</span> <span class="o">+</span><span class="nx">left</span><span class="p">;</span>
          <span class="nx">right</span> <span class="o">=</span> <span class="o">+</span><span class="nx">right</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><code>NaN</code>s are equivalent, but non-reflexive. An <code>egal</code> comparison is
performed for other numeric values.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">left</span> <span class="o">!=</span> <span class="nx">left</span> <span class="o">?</span> <span class="nx">right</span> <span class="o">!=</span> <span class="nx">right</span> <span class="o">:</span> <span class="p">(</span><span class="nx">left</span> <span class="o">?</span> <span class="nx">left</span> <span class="o">==</span> <span class="nx">right</span> <span class="o">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">left</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">right</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Coerce dates and booleans to numeric primitive values. Dates are
compared by their millisecond representations; invalid dates are not
equivalent.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">case</span> <span class="s2">&quot;[object Date]&quot;</span><span class="o">:</span>
        <span class="k">case</span> <span class="s2">&quot;[object Boolean]&quot;</span><span class="o">:</span>
          <span class="k">return</span> <span class="o">+</span><span class="nx">left</span> <span class="o">==</span> <span class="o">+</span><span class="nx">right</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>RegExps are compared by their source patterns, flags, and
last-matched index.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">case</span> <span class="s2">&quot;[object RegExp]&quot;</span><span class="o">:</span>
          <span class="k">return</span> <span class="nx">left</span><span class="p">.</span><span class="nx">source</span> <span class="o">==</span> <span class="nx">right</span><span class="p">.</span><span class="nx">source</span> <span class="o">&amp;&amp;</span>
                 <span class="nx">left</span><span class="p">.</span><span class="nx">global</span> <span class="o">==</span> <span class="nx">right</span><span class="p">.</span><span class="nx">global</span> <span class="o">&amp;&amp;</span>
                 <span class="nx">left</span><span class="p">.</span><span class="nx">multiline</span> <span class="o">==</span> <span class="nx">right</span><span class="p">.</span><span class="nx">multiline</span> <span class="o">&amp;&amp;</span>
                 <span class="nx">left</span><span class="p">.</span><span class="nx">ignoreCase</span> <span class="o">==</span> <span class="nx">right</span><span class="p">.</span><span class="nx">ignoreCase</span> <span class="o">&amp;&amp;</span>
                 <span class="nx">left</span><span class="p">.</span><span class="nx">lastIndex</span> <span class="o">==</span> <span class="nx">right</span><span class="p">.</span><span class="nx">lastIndex</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">left</span> <span class="o">!=</span> <span class="s2">&quot;object&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">right</span> <span class="o">!=</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Assume equality for cyclic structures. The algorithm for detecting
cyclic structures is adapted from ES 5.1 section 15.12.3, abstract
operation <code>JO</code>. This is a linear search; performance is inversely
proportional to the number of unique nested objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="nx">size</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">size</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">size</span><span class="p">]</span> <span class="o">==</span> <span class="nx">left</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Add the first object to the stack of traversed objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">left</span><span class="p">);</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Recursively compare objects and arrays.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">==</span> <span class="s2">&quot;[object Array]&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Compare array lengths to determine if a deep comparison is necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">size</span> <span class="o">=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">==</span> <span class="nx">right</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Deep compare the contents, ignoring non-numeric properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">while</span> <span class="p">(</span><span class="nx">size</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Ensure commutative equality for sparse arrays.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">result</span> <span class="o">=</span> <span class="p">(</span><span class="nx">size</span> <span class="k">in</span> <span class="nx">left</span> <span class="o">==</span> <span class="nx">size</span> <span class="k">in</span> <span class="nx">right</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">left</span><span class="p">[</span><span class="nx">size</span><span class="p">],</span> <span class="nx">right</span><span class="p">[</span><span class="nx">size</span><span class="p">],</span> <span class="nx">stack</span><span class="p">)))</span> <span class="p">{</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Deep compare objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">result</span> <span class="o">=</span> <span class="nx">all</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Count the expected number of properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">size</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Deep compare each own object member.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">right</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">right</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Ensure that both objects contain the same number of properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">all</span><span class="p">(</span><span class="nx">right</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">size</span><span class="o">--</span><span class="p">;</span>
          <span class="p">});</span>
          <span class="nx">result</span> <span class="o">=</span> <span class="o">!</span><span class="nx">size</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Remove the first object from the stack of traversed objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Define the top-level <code>equals</code> function.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">equals</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Apply the comparison function left-to-right until all the provided
arguments have been consumed.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">eq</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[]))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">equals</span><span class="p">;</span>
  <span class="p">})(),</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p><strong>defer</strong> attempts to execute a callback function asynchronously in supported
environments.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">defer</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p><code>process.nextTick</code> executes a function asynchronously in Node.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">Environment</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defer</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">defer</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p><code>process.nextTick</code> is an efficient alternative to <code>setTimeout(..., 0)</code>.
As of Node 0.6.9, neither <code>process.nextTick</code> nor <code>setTimeout</code> isolate
execution; if the <code>callback</code> throws an exception, subsequent deferred
callbacks <strong>will not execute</strong>. This is an unfortunate incompatibility
with both the <code>setTimeout</code> function exposed in Browsers and Phantom,
and the Java <code>Timer</code> API exposed via LiveConnect in Rhino.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Browsers and Phantom provide the <code>setTimeout</code> function.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Environment</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defer</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">defer</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Mozilla Rhino's LiveConnect interface exposes the Java <code>Timer</code> API for
executing tasks in a background thread.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Environment</span><span class="p">.</span><span class="nx">java</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defer</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">defer</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">java</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Timer</span><span class="p">(),</span> <span class="nx">task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Runnable</span><span class="p">({</span>
        <span class="s2">&quot;run&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Terminate the background thread once the task runs. If the thread
is not terminated, the Rhino process will persist even after
execution is completed.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">timer</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
          <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Schedule the timer task for background execution. A new scheduler is
created for each task to ensure that exceptions do not leak between
tasks.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">timer</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="k">new</span> <span class="nx">java</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">TimerTask</span><span class="p">(</span><span class="nx">task</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Execute the callback function synchronously in other environments.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">defer</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">defer</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Export the <code>defer</code> function.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">exports</span><span class="p">.</span><span class="nx">defer</span> <span class="o">=</span> <span class="nx">defer</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <h2>Custom Events</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p><code>Spec.Events</code> provides an interface for managing custom events. You can
add and remove individual event handlers; triggering an event executes its
handlers in succession. Based on work by Jeremy Ashkenas.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">exports</span><span class="p">.</span><span class="nx">Events</span> <span class="o">=</span> <span class="nx">Events</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">Events</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p><strong>on</strong> attaches a handler function, specified by the <code>callback</code> argument,
to an <code>event</code>. The callback will be invoked whenever the event, specified
by a string identifier, is fired. If the optional <code>context</code> argument is
provided, the <code>callback</code> will be bound to it. Callbacks attached to the
special <code>all</code> event will be invoked for <strong>all</strong> triggered events.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Events</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="nx">Events</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addListener</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">previous</span><span class="p">,</span> <span class="nx">event</span><span class="p">;</span>
    <span class="nx">events</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="nx">callbacks</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span>
        <span class="nx">target</span> <span class="o">=</span> <span class="nx">callbacks</span> <span class="o">?</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">previous</span> <span class="o">:</span> <span class="p">{};</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">previous</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Create a new event target node.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;previous&quot;</span><span class="o">:</span> <span class="nx">previous</span><span class="p">,</span>
          <span class="s2">&quot;next&quot;</span><span class="o">:</span> <span class="nx">callbacks</span> <span class="o">?</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">next</span> <span class="o">:</span> <span class="nx">target</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p><strong>removeListener</strong> removes a previously-bound event handler. If the
<code>callback</code> is omitted, all handlers for the event type will be removed. If
both the event type <em>and</em> handler are omitted, <strong>all</strong> event handlers will
be removed. If the <code>context</code> is omitted, all versions of the handler,
including those bound to different contexts, will be removed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Events</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">previous</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Remove all callbacks.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">),</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">events</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">event</span><span class="p">]))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Remove the callback registry.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">previous</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">previous</span><span class="p">;</span> <span class="p">(</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">previous</span><span class="p">;)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Create a new registry, omitting the specified callbacks.</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">callback</span> <span class="o">!=</span> <span class="nx">callback</span> <span class="o">||</span> <span class="p">(</span><span class="nx">context</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">.</span><span class="nx">context</span> <span class="o">!=</span> <span class="nx">context</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">target</span><span class="p">.</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">target</span><span class="p">.</span><span class="nx">context</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p><strong>removeAllListeners</strong> removes <em>all</em> registered handlers for an <code>event</code>,
or all handlers for all events if the <code>event</code> is omitted. This method is
deprecated; it is provided only for compatibility with v1.0.0rc3.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Events</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAllListeners</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">events</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p><strong>once</strong> registers a one-time event handler for the specified <code>event</code>. The
handler is invoked only the first time the <code>event</code> is triggered, after
which it is removed. This method is deprecated.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Events</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">onEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">onEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">onEvent</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">onEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p><strong>emit</strong> fires an event, specified by either a string identifier or an
event object with a <code>type</code> property.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Events</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">emit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">previous</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">error</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Convert a string identifier into an event object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">event</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="o">||</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;[object String]&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="nx">event</span> <span class="p">};</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Capture a reference to the current event target.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isPropertyOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Capture a reference to the callback registry for the <code>all</code> event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">all</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">all</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">]))</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">previous</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">previous</span><span class="p">;</span> <span class="p">(</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">previous</span><span class="p">;)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Execute the callbacks in succession.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">target</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">error</span> <span class="o">=</span> <span class="nx">exception</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Re-throw exceptions asynchronously, allowing all subsequent
callbacks to fire.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">exports</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Fire the <code>all</code> event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">previous</span> <span class="o">=</span> <span class="nx">all</span><span class="p">.</span><span class="nx">previous</span><span class="p">;</span> <span class="p">(</span><span class="nx">all</span> <span class="o">=</span> <span class="nx">all</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">previous</span><span class="p">;)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">all</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">all</span><span class="p">.</span><span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">error</span> <span class="o">=</span> <span class="nx">exception</span><span class="p">;</span>
          <span class="nx">exports</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <h2>Suites</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Suites are event-driven collections of unit tests. Using custom events, you
can create routines for setting up and tearing down tests, handling
assertions and failures, and logging test results.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">exports</span><span class="p">.</span><span class="nx">Suite</span> <span class="o">=</span> <span class="nx">Suite</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Creates a new suite with an optional <code>name</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">Suite</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Events</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">!=</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>The default suite name.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Anonymous Suite&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Add support for custom events.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Events</span><span class="p">();</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Suite</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Array methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">join</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">join</span><span class="p">;</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pop</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">pop</span><span class="p">;</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">push</span><span class="p">;</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reverse</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">reverse</span><span class="p">;</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">shift</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">shift</span><span class="p">;</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sort</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">sort</span><span class="p">;</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">splice</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">splice</span><span class="p">;</span>
  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unshift</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">unshift</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Shuffles the suite using a Fisher-Yates shuffle.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">shuffle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">length</span><span class="p">;)</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">length</span><span class="p">);</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="o">--</span><span class="nx">length</span><span class="p">];</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Adds a test to the suite. The test name is optional.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addTest</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Test</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">test</span><span class="p">));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Returns the index of the next available test relative to the given
<code>position</code>, or <code>null</code> if no additional tests are available.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">test</span><span class="p">;</span>
    <span class="nx">position</span> <span class="o">=</span> <span class="nx">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">length</span> <span class="o">+</span> <span class="nx">position</span> <span class="o">:</span> <span class="p">(</span><span class="nx">position</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="nx">position</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">position</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">test</span> <span class="o">=</span> <span class="nx">position</span> <span class="k">in</span> <span class="k">this</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="nx">position</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">test</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">test</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">test</span> <span class="k">instanceof</span> <span class="nx">Test</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">position</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">nil</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Runs the suite.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Suite</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">run</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Create the spec summary.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">suite</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">position</span> <span class="o">=</span> <span class="nx">suite</span><span class="p">.</span><span class="nx">assertions</span> <span class="o">=</span> <span class="nx">suite</span><span class="p">.</span><span class="nx">failures</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">target</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Internal event handler invoked each time a test emits an event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">onEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Proxy the fired event.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">suite</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Update the suite summary.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">case</span> <span class="s2">&quot;assertion&quot;</span><span class="o">:</span>
          <span class="nx">suite</span><span class="p">.</span><span class="nx">assertions</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;failure&quot;</span><span class="o">:</span>
          <span class="nx">suite</span><span class="p">.</span><span class="nx">failures</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;teardown&quot;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Unbind the internal event handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">target</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="nx">onEvent</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">((</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">suite</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="nx">position</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">target</span> <span class="o">=</span> <span class="nx">suite</span><span class="p">[</span><span class="nx">position</span><span class="p">];</span>
            <span class="nx">defer</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="nx">onEvent</span><span class="p">).</span><span class="nx">run</span><span class="p">,</span> <span class="nx">target</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">suite</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;complete&quot;</span><span class="p">);</span>
          <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Begin running the unit tests.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">suite</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Bind the internal event handler to the first test.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">((</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">suite</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="nx">position</span><span class="p">))</span> <span class="o">!=</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">target</span> <span class="o">=</span> <span class="nx">suite</span><span class="p">[</span><span class="nx">position</span><span class="p">];</span>
      <span class="nx">defer</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="nx">onEvent</span><span class="p">).</span><span class="nx">run</span><span class="p">,</span> <span class="nx">target</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Finish running the suite.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">suite</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;complete&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">suite</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <h2>Tests</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Wraps a test function with convenience methods and assertions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">exports</span><span class="p">.</span><span class="nx">Test</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">Test</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Events</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">test</span> <span class="o">==</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">test</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
      <span class="nx">name</span> <span class="o">=</span> <span class="nx">nil</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">!=</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">test</span> <span class="o">=</span> <span class="nx">test</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>Bind the helper event handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onEvent</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>Add support for custom events.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Events</span><span class="p">();</span>
  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>The default test name.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Anonymous Test&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>An event handler invoked each time a test emits an event.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onEvent</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">expected</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;setup&quot;</span><span class="o">:</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">assertions</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">failures</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;assertion&quot;</span><span class="o">:</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">assertions</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;failure&quot;</span><span class="o">:</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">failures</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;teardown&quot;</span><span class="o">:</span>
        <span class="nx">expected</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">expected</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Verify that the expected number of assertions were executed.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">expected</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="o">||</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">expected</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;[object Number]&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">expected</span> <span class="o">!=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">assertions</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">target</span><span class="p">.</span><span class="nx">emit</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;failure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;actual&quot;</span><span class="o">:</span> <span class="nx">target</span><span class="p">.</span><span class="nx">assertions</span><span class="p">,</span>
            <span class="s2">&quot;expected&quot;</span><span class="o">:</span> <span class="nx">expected</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="o">:</span> <span class="s2">&quot;done&quot;</span>
          <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p><strong>assert</strong> creates a new assertion method with the given <code>name</code>. If the
provided <code>callback</code> function returns a falsy value, the assertion fails.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">assert</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">),</span> <span class="p">{</span>
        <span class="s2">&quot;actual&quot;</span><span class="o">:</span> <span class="nx">actual</span><span class="p">,</span>
        <span class="s2">&quot;expected&quot;</span><span class="o">:</span> <span class="nx">expected</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="o">:</span> <span class="nx">message</span> <span class="o">==</span> <span class="nx">nil</span> <span class="o">?</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">message</span>
      <span class="p">});</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Runs the test.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">run</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>Pass the wrapper as the first argument to the test function.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p><strong>ok</strong> tests whether an <code>expression</code> is truthy. The optional <code>message</code>
defaults to the name of the current assertion (e.g., <code>ok</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ok</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;actual&quot;</span><span class="o">:</span> <span class="nx">expression</span><span class="p">,</span>
        <span class="s2">&quot;expected&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="o">:</span> <span class="nx">event</span> <span class="o">==</span> <span class="nx">nil</span> <span class="o">?</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="nx">event</span>
      <span class="p">};</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Note: To test for the boolean <code>true</code>, use the <code>strictEqual</code> assertion.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">expression</span> <span class="o">?</span> <span class="s2">&quot;assertion&quot;</span> <span class="o">:</span> <span class="s2">&quot;failure&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p><strong>notOk</strong> tests whether an <code>expression</code> is falsy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notOk</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="o">!</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">message</span> <span class="o">==</span> <span class="nx">nil</span> <span class="o">?</span> <span class="s2">&quot;notOk&quot;</span> <span class="o">:</span> <span class="nx">message</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p><strong>equal</strong> tests whether <code>actual</code> is <strong>equal</strong> to <code>expected</code>, as determined
by the <code>==</code> operator.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">equal</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">actual</span> <span class="o">==</span> <span class="nx">expected</span><span class="p">;</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p><strong>notEqual</strong> tests for <strong>loose</strong> or coercive inequality.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notEqual</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="s2">&quot;notEqual&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">actual</span> <span class="o">!=</span> <span class="nx">expected</span><span class="p">;</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p><strong>strictEqual</strong> tests for <strong>strict</strong> equality (<code>actual === expected</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">strictEqual</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="s2">&quot;strictEqual&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">actual</span> <span class="o">===</span> <span class="nx">expected</span><span class="p">;</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p><strong>notStrictEqual</strong> tests for strict inequality.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notStrictEqual</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="s2">&quot;notStrictEqual&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">actual</span> <span class="o">!==</span> <span class="nx">expected</span><span class="p">;</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p><strong>deepEqual</strong> tests for deep equality and equivalence, as determined by the
<code>Spec.equals</code> function.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deepEqual</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="s2">&quot;deepEqual&quot;</span><span class="p">,</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">equals</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p><strong>notDeepEqual</strong> tests for deep inequality.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notDeepEqual</span> <span class="o">=</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="s2">&quot;notDeepEqual&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">exports</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">);</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>Ensures that the <code>callback</code> function throws an exception.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">isRegExp</span> <span class="o">=</span> <span class="nx">expected</span> <span class="o">&amp;&amp;</span> <span class="nx">getClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">expected</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;[object RegExp]&quot;</span><span class="p">,</span> <span class="nx">isFunction</span> <span class="o">=</span> <span class="o">!</span><span class="nx">isRegExp</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">expected</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>Invalid expected value; the message was passed as the second argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isFunction</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isRegExp</span> <span class="o">&amp;&amp;</span> <span class="nx">message</span> <span class="o">==</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">message</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>
      <span class="nx">expected</span> <span class="o">=</span> <span class="nx">nil</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ok</span> <span class="o">=</span> <span class="nx">expected</span> <span class="o">==</span> <span class="nx">nil</span> <span class="o">||</span> <span class="p">(</span><span class="nx">isRegExp</span> <span class="o">&amp;&amp;</span> <span class="nx">expected</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">exception</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="nx">isFunction</span> <span class="o">&amp;&amp;</span> <span class="nx">expected</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">exception</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">ok</span><span class="p">,</span> <span class="nx">message</span> <span class="o">==</span> <span class="nx">nil</span> <span class="o">?</span> <span class="s2">&quot;error&quot;</span> <span class="o">:</span> <span class="nx">message</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>Ensures that the <code>callback</code> function does not throw any exceptions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">noError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">ok</span><span class="p">,</span> <span class="nx">message</span> <span class="o">==</span> <span class="nx">nil</span> <span class="o">?</span> <span class="s2">&quot;noError&quot;</span> <span class="o">:</span> <span class="nx">message</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p><strong>done</strong> completes a test with an optional number of expected <code>assertions</code>.
This method <strong>must</strong> be called at the end of each test.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Test</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assertions</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">({</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;teardown&quot;</span><span class="p">,</span>
      <span class="s2">&quot;expected&quot;</span><span class="o">:</span> <span class="nx">assertions</span>
    <span class="p">});</span>
  <span class="p">};</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 